/* eslint-disable vue/no-v-html */
<script>
  // @ is an alias to /src

  import Vue from 'vue';

  import { mapActions, mapState } from 'vuex';
  import { db } from '@/plugins/firebase';
  import { sortByKey } from '@/utilities/utils';
  import { isoDate } from '@/filters';

  import IssueBlock from '@/components/IssueBlock.vue';

  import SvgPanZoom from 'vue-svg-pan-zoom';
  import VueHotKey from 'v-hotkey';
  Vue.use(VueHotKey);
  import VueBlobJsonCsv from 'vue-blob-json-csv';
  Vue.use(VueBlobJsonCsv);

  export default {
    name: 'IssuesGrid',
    components: { 'issue-block': IssueBlock /* 'svg-pan-zoom': SvgPanZoom*/ },
    props: {
      workshopId: undefined,
      projectId: undefined,
      embedded: { type: Boolean, default: false },
    },
    data: () => ({
      show: {},
      syncedView: undefined,
      staleAge: 1000 * 60 * 5, // 5 minutes
      showDeletedViews: false,
      priorities: ['Critical', 'High', 'Low'],
      elementLabels: [],
      actioners: [],
      loadingImages: false,
      mapDrawer: false,
      mapCollapse: false,
      mapTimeout: -1,
      viewpointsplay: ``,
      bbox: `<path dd:_xmax="450999.79390273435" dd:_xmin="450812.426146213" dd:_ymax="207169.05145256652" dd:_ymin="206970.20592750813" dd:_zmax="0" dd:_zmin="0" d="M 0,0 l 0,199 187,0 0,-199 -187,0 z "/>`,
      footprint: `<path d="M 72.1,55.4 l 0,7.27 0,4.48 -18.7,0 0,8.48 0.721,0 0,7.19 -0.723,0 0,4.04 0,21.8 0.562,0 0,7.19 -0.561,0 0,6.81 0,10 2.12,0 0,2.67 2.78,0 0,11 3.72,0 0,-13.7 10.1,0 0,9.05 25.9,0 0,-11.8 18.7,0 0,-0.677 8.64,0 5.22,-10.6 0,-10 0.595,0 0,-22.5 0,-3.35 -1,0 0,-7.19 3.82,0 0,-16.8 -36,0 0,-3.46 -25.9,0 z "/>`,
      grid: `<path d="M 94.3,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 94,148 l 0,-98.6 "/>
    <path d="M 47.5,53.6 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 47.6,53.8 l 92.9,0 "/>
    <path d="M 52.3,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 52,148 l 0,-98.6 "/>
    <path d="M 50.7,102 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 50.9,102 l 89.7,0 "/>
    <path d="M 50.7,95.6 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 50.9,95.8 l 89.7,0 "/>
    <path d="M 106,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 106,148 l 0,-98.6 "/>
    <path d="M 64.3,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 64,148 l 0,-98.6 "/>
    <path d="M 50.7,71.6 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 50.9,71.8 l 89.7,0 "/>
    <path d="M 118,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 118,148 l 0,-98.6 "/>
    <path d="M 112,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 112,148 l 0,-98.6 "/>
    <path d="M 50.7,83.6 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 50.9,83.8 l 89.7,0 "/>
    <path d="M 136,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 136,148 l 0,-98.6 "/>
    <path d="M 82.3,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 82,148 l 0,-98.6 "/>
    <path d="M 88.3,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 88,148 l 0,-98.6 "/>
    <path d="M 50.7,89.6 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 50.9,89.8 l 89.7,0 "/>
    <path d="M 124,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 124,148 l 0,-98.6 "/>
    <path d="M 47.5,65.6 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 47.6,65.8 l 92.9,0 "/>
    <path d="M 85.3,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 85,148 l 0,-98.6 "/>
    <path d="M 47.5,59.6 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 47.6,59.8 l 92.9,0 "/>
    <path d="M 47.5,126 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 47.6,126 l 92.9,0 "/>
    <path d="M 100,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 100,148 l 0,-98.6 "/>
    <path d="M 50.7,77.6 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 50.9,77.8 l 89.7,0 "/>
    <path d="M 47.5,132 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 47.6,132 l 92.9,0 "/>
    <path d="M 70.3,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 70,148 l 0,-98.6 "/>
    <path d="M 47.5,138 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 47.6,138 l 92.9,0 "/>
    <path d="M 50.7,108 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 50.9,108 l 89.7,0 "/>
    <path d="M 47.5,120 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 47.6,120 l 92.9,0 "/>
    <path d="M 58.3,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 58,148 l 0,-98.6 "/>
    <path d="M 76.3,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 76,148 l 0,-98.6 "/>
    <path d="M 50.7,114 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 50.9,114 l 89.7,0 "/>
    <path d="M 130,148 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 130,148 l 0,-98.6 "/>
    <path d="M 47.5,144 l 0.0241,0.0252 0.0218,0.0272 0.0194,0.029 0.0167,0.0306 0.014,0.032 0.0112,0.0331 0.00825,0.0339 0.00527,0.0345 0.00224,0.0348 -0.000802,0.0349 -0.00384,0.0347 -0.00685,0.0342 -0.0098,0.0335 -0.0127,0.0325 -0.0155,0.0313 -0.0181,0.0298 -0.0207,0.0281 -0.023,0.0262 -0.0252,0.0241 -0.0272,0.0218 -0.029,0.0194 -0.0306,0.0167 -0.032,0.014 -0.0331,0.0112 -0.0339,0.00825 -0.0345,0.00527 -0.0348,0.00224 -0.0349,-0.000802 -0.0347,-0.00384 -0.0342,-0.00685 -0.0335,-0.0098 -0.0325,-0.0127 -0.0313,-0.0155 -0.0298,-0.0181 -0.0281,-0.0207 -0.0262,-0.023 -0.0241,-0.0252 -0.0218,-0.0272 -0.0194,-0.029 -0.0167,-0.0306 -0.014,-0.032 -0.0112,-0.0331 -0.00825,-0.0339 -0.00527,-0.0345 -0.00224,-0.0348 0.000802,-0.0349 0.00384,-0.0347 0.00685,-0.0342 0.0098,-0.0335 0.0127,-0.0325 0.0155,-0.0313 0.0181,-0.0298 0.0207,-0.0281 0.023,-0.0262 0.0252,-0.0241 0.0272,-0.0218 0.029,-0.0194 0.0306,-0.0167 0.032,-0.014 0.0331,-0.0112 0.0339,-0.00825 0.0345,-0.00527 0.0348,-0.00224 0.0349,0.000802 0.0347,0.00384 0.0342,0.00685 0.0335,0.0098 0.0325,0.0127 0.0313,0.0155 0.0298,0.0181 0.0281,0.0207 0.0262,0.023 M 47.6,144 l 92.9,0 "/>`,
      mapViewBox: [0, 0, 187, 199],
      mapExtents: {
        maxX: 450999.79390273435,
        maxY: 207169.05145256652,
        minX: 450812.426146213,
        minY: 206970.20592750813,
      },
      mapTranslate: [0, 199],
      mapZoomFactor: 1,
    }),
    computed: {
      ...mapState({
        views: (state) => state.views,
        issues: (state) => state.issues,
        activeIssue: (state) => state.activeIssue,
        currentWorkshop: (state) => state.currentWorkshop,
      }),
      selectedIssue: {
        get() {
          if (
            this.syncedView &&
            this.currentWorkshop &&
            this.embedded === false
          ) {
            return this.currentWorkshop.viewingIssue;
          }

          return this.activeIssue;
        },
        set(issue) {
          if (this.embedded === false) {
            this.syncedView = false;
            this.$store.commit('SET_SELECTED_ISSUE', issue ?? null);
            return;
          }
          if (
            this.viewsPerIssue &&
            this.viewsPerIssue.findIndex((x) => {
              return x.id === issue;
            }) >= 0
          ) {
            this.$store.dispatch('ISSUE_VIEW', {
              issue,
              workshop: this.workshopId,
            });
          } else if (!issues) {
            this.$store.dispatch('ISSUE_VIEW', {
              issue: null,
              workshop: this.workshopId,
            });
          }
        },
      },
      hosted() {
        return window.UIBindings ? 'Hosted in Navisworks' : 'Shown in Browser';
      },
      issueList() {
        return this.issues
          .filter((issue) => Boolean(issue.number))
          .map((issue) => issue);
      },
      issueIdList() {
        return this.issues
          .filter((issue) => Boolean(issue.id))
          .map((issue) => issue.id);
      },
      viewList() {
        return this.views
          .filter((view) => Boolean(view.issueId))
          .map((view) => view);
      },
      route() {
        return this.$route.name;
      },
      viewsPerIssue() {
        const iv = this.issueList.map((issue) => {
          return {
            ...issue,
            id: issue.id,
            views: this.views.filter((view) => view.issueId === issue.id),
          };
        });
        return sortByKey(iv, 'number', 'asc');
      },
      activeIndex() {
        if (this.viewsPerIssue) {
          return this.viewsPerIssue.findIndex((x) => {
            return x.id === this.activeIssue;
          });
        }
        return undefined;
      },
      hasBindings() {
        return Boolean(window.UIBindings);
      },
      analystsIssue() {
        return this.currentWorkshop && this.currentWorkshop.viewingIssue;
      },
      viewAge() {
        const now = new Date().getTime();
        let age = now;

        if (this.currentWorkshop && this.currentWorkshop.lastViewed) {
          age = this.currentWorkshop.lastViewed.toDate().getTime();
        }

        return now - age;
      },
      isPrint() {
        return window.matchMedia('print').matches;
      },
      projectWorkshopDetails() {
        const details = this.$store.getters['singleWorkshopDetails'](
          (this.currentWorkshop && this.currentWorkshop.id) || ''
        );
        return details;
      },
      csvFileName() {
        let filename;
        if (this.projectWorkshopDetails && this.$options.filters) {
          filename = `${
            this.projectWorkshopDetails.project.key
          } Workshop Issues (${isoDate(
            this.projectWorkshopDetails.workshop.meetingDate
          )})`;
        }
        return filename;
      },
      csvData() {
        const csvData = [];
        if (this.viewsPerIssue) {
          [...this.issueList].reduce((data, issue) => {
            const {
              number,
              summary: Summary,
              description: Description,
              actionRequired,
              actioners,
              elements,
              priority: Priority,
            } = issue;

            data.push({
              'Issue Number': ('00000' + number).slice(-3),
              Summary,
              Description,
              'Action Required': actionRequired,
              'Action Required From': `"${(actioners || []).join(', ')}"`,
              Priority,
              Elements: `"${(elements || []).join(', ')}"`,
            });
            return data;
          }, csvData);
        }
        return csvData.sort((a, b) => {
          const A = a['Issue Number'],
            B = b['Issue Number'];
          return A === B ? 0 : A > B ? 1 : -1;
        });
      },
      isEmbedded() {
        return (
          Boolean(window.UIBindings) || Boolean(this.$route.query.pane === true)
        );
      },
      keymap() {
        return {
          n: this.next,
          p: this.prev,
        };
      },
      mapAbsoluteDims() {
        const width = this.mapExtents.maxX - this.mapExtents.minX;
        const height = this.mapExtents.maxY - this.mapExtents.minY;

        return { width, height };
      },
    },
    watch: {
      views() {
        if (this.viewsPerIssue && this.selectedIssue) {
          const index = this.viewsPerIssue.findIndex(
            (el) => el.id === this.selectedIssue
          );

          if (this.viewsPerIssue[index]) {
            const views = this.viewsPerIssue[index].views;
            if (views) {
              this.mapViewpoints(
                views
                  .map((view, vpIndex) => {
                    if (view.viewpoint) {
                      view.viewpoint.$label = `${vpIndex + 1}`;
                      return view.viewpoint;
                    }
                  })
                  .filter((view) => Boolean(view))
              );
            }
          }
        }
      },
      workshopId(ref) {
        console.log(ref);
        if (ref) this.bindWorkshop();
      },
      issueIdList(issues, oldIssues) {
        if (issues && issues.length > 0) {
          const a = new Set(issues),
            b = new Set(oldIssues);

          const diff = new Set([...a].filter((x) => !b.has(x)));

          if (diff.size > 0) {
            const elements = new Set();
            const actioners = new Set();

            // console.log({ issueList: this.issueList });

            [...this.issueList].forEach((issue) => {
              if (issue && issue.elements && issue.elements.length > 0) {
                [...issue.elements].reduce(
                  (set, element) => set.add(element),
                  elements
                );
              }
              if (issue && issue.actioners && issue.actioners.length > 0) {
                [...issue.actioners].reduce(
                  (set, actioner) => set.add(actioner),
                  actioners
                );
              }
            });
            this.elementLabels = [...elements];
            this.actioners = [...actioners];
          }
        }
      },
    },
    mounted: function () {
      if (this.workshopId) {
        this.bindWorkshop();
      }
    },
    created: function () {
      if (this.viewsPerIssue && this.selectedIssue) {
        const index = this.viewsPerIssue.findIndex(
          (el) => el.id === this.selectedIssue
        );

        const views = this.viewsPerIssue[index].views;
        if (views) {
          this.mapViewpoints(
            views
              .map((view, vpIndex) => {
                if (view.viewpoint) {
                  view.viewpoint.$label = `${vpIndex + 1}`;
                  return view.viewpoint;
                }
              })
              .filter((view) => Boolean(view))
          );
        }
      }
    },
    methods: {
      ...mapActions([
        'bindCurrentWorkshop',
        'bindCurrentProject',
        'bindWorkshopViews',
        'bindWorkshopViewsByQuery',
        'bindWorkshopIssues',
      ]),
      async bindWorkshop() {
        const currentWorkshop = await this.bindCurrentWorkshop(this.workshopId);
        const currentProject = await this.bindCurrentProject(this.projectId);

        const workshopViews = await this.bindWorkshopViews(
          this.workshopId,
          false
        );
        const workshopIssues = await this.bindWorkshopIssues(
          this.workshopId,
          false
        );

        // console.log({ currentWorkshop, workshopViews, workshopIssues });
      },
      selectIssue(issue, e) {
        e && e.stopPropagation();

        if (!issue) return (this.selectedIssue = undefined);

        const { id: issueId, index } = issue;

        if (issueId === this.selectedIssue) {
          this.selectedIssue = undefined;
        } else {
          console.log('selectIssue', issue);

          this.selectedIssue = issueId;

          // if (this.viewsPerIssue) {
          //   const views = this.viewsPerIssue[index].views;
          //   if (views) {
          //     this.mapViewpoints(
          //       views
          //         .map((view, vpIndex) => {
          //           if (view.viewpoint) {
          //             view.viewpoint.$label = `${vpIndex + 1}`;
          //             return view.viewpoint;
          //           }
          //         })
          //         .filter((view) => Boolean(view))
          //     );
          //   }
          // }
        }
      },
      toggleSync() {
        if (this.syncedView === true) {
          this.$store.commit('SET_SELECTED_ISSUE', this.analystsIssue ?? null);
        }
        this.syncedView = !this.syncedView;
      },
      deleteImage(view) {
        if (view.id) {
          db.collection('views')
            .doc(view.id)
            .update({ deleted: !view.deleted });
        }
      },
      async toggleDeleted() {
        let query = db
          .collection('views')
          .where('workshopId', '==', this.workshopId);

        if (this.showDeletedViews) {
          query = query.where('deleted', '==', false);
        }

        const options = { reset: false };
        this.loadingImages = true;

        const viewByQuery = await this.bindWorkshopViewsByQuery(
          this.workshopId,
          query
        );

        console.log({ viewByQuery });

        this.loadingImages = false;
        this.showDeletedViews = !this.showDeletedViews;
      },
      async editIssueField({ id: issueId, value, field }) {
        let ref;

        if (issueId) {
          await this.$store.dispatch('UPDATE_ISSUE_FIELD', {
            issueId,
            field,
            value,
          });
        }
        if (ref && (field === 'elements' || field === 'actioners')) {
          if (field === 'elements') {
            const labels = new Set();
            [...this.elementLabels, ...value].reduce(
              (set, element) => set.add(element),
              labels
            );
            this.elementLabels = [...labels];
          }
          if (field === 'actioners') {
            const actioners = new Set();
            [...this.actioners, ...value].reduce(
              (set, actioner) => set.add(actioner),
              actioners
            );
            this.actioners = [...actioners];
          }
        }
      },
      scrollTo(issueId) {
        const el = document.querySelector(`[data-issue-id="${issueId}"]`);
        if (el) {
          Vue.Vue.nextTick(() => {
            this.$vuetify.goTo(el, { offset: 50 });
          });
        }
      },
      next() {
        // console.log('next');
      },
      prev() {
        // console.log('prev');
      },
      deleteIssue(issueId, _$event) {
        this.$store.dispatch('DELETE_ISSUE', issueId);
      },
      async shiftIssue(index, data) {
        const { id: issueId, direction } = data;

        if (
          !this.viewsPerIssue ||
          (direction !== 'up' && direction !== 'down') ||
          (direction === 'up' && index === 0) ||
          (direction === 'down' && index === this.viewsPerIssue.length - 1)
        ) {
          return;
        }

        const directionMap = { up: -1, down: 1 };

        if (directionMap[direction]) {
          const thisIssue = this.viewsPerIssue[index];
          const thatIssue = this.viewsPerIssue[index + directionMap[direction]];

          const field = 'number';

          if (thatIssue.id && thisIssue.id) {
            await Promise.allSettled([
              this.$store.dispatch('UPDATE_ISSUE_FIELD', {
                issueId,
                field,
                value: thatIssue.number,
              }),
              this.$store.dispatch('UPDATE_ISSUE_FIELD', {
                issueId: thatIssue.id,
                field,
                value: thisIssue.number,
              }),
            ]);
          }
        }
      },
      mapViewpoints(views) {
        this.viewpointsplay = views.reduce((viewpointSVG, viewpoint) => {
          if (viewpoint) {
            const splayStart = `<g class="splay">`;
            const splayEnd = `</g>`;
            let splay = '';

            const { $type } = viewpoint;

            if ($type === 'OrthogonalCamera') {
              // console.log('OrthogonalCamera not implemented');
              splay = '<!-- OrthogonalCamera not implemented -->';
            } else {
              const {
                FieldOfView: fovV,
                CameraViewpoint: vpPos,
                CameraDirection: dir,
                // CameraUpVector: up,
              } = viewpoint;
              const width = 1600,
                height = 900;
              const fovH =
                2 * Math.atan(width / 2 / (height / 2) / Math.tan(fovV / 2));
              const fovH_deg = (fovH * 180) / Math.PI;

              const dx = vpPos.X - this.mapExtents.minX,
                dy = vpPos.Y - this.mapExtents.minY;

              let directionAngle = (Math.atan(dir.Y / dir.X) * 180) / Math.PI;

              if (dir.X < 0) directionAngle += 90;
              if (dir.X > 0) directionAngle -= 90;

              // console.log({
              //   label: viewpoint.$label,
              //   X: dir.X,
              //   Y: dir.Y,
              // });

              splay = `
  <g transform="translate(${dx},${dy})">
    <g transform="rotate(${directionAngle},0,0)" class="map-splay">
      <path transform="rotate(${
        fovH_deg / 4
      },0,0)" vector-effect="non-scaling-stroke" d="M 0,0 l 0,20"/>
      <path transform="rotate(-${
        fovH_deg / 4
      },0,0)" vector-effect="non-scaling-stroke" d="M 0,0 l 0,20"/>
      <circle class="map-vp" cx="0" cy="-5" r="5" vector-effect="non-scaling-stroke">
      </circle>
        <text transform="scale(1,-1)" dominant-baseline="middle" text-anchor="middle" x="0" y="5.5" class="map-vp-index">${
          viewpoint.$label
        }</text>
    </g>
  </g>`;
            }
            viewpointSVG += `${splayStart}${splay}${splayEnd}`;
          }
          return viewpointSVG;
        }, '');
      },
    },
  };
</script>

<template>
  <v-container
    v-if="viewsPerIssue"
    dense
    :class="{
      browser: !embedded,
      syncing: syncedView,
      stale: 0 < viewAge && viewAge < staleAge,
      printMode: isPrint,
    }"
    class="pt-0 list pl-6"
  >
    <v-row v-if="!isEmbedded" class="header-actions">
      <v-col align-self="end">
        <v-card class="pa-0 mx-0" flat>
          <v-card-actions
            style="
              justify-content: start;
              padding-right: 30px;
              flex-direction: row-reverse;
            "
          >
            <vue-blob-json-csv
              v-if="projectWorkshopDetails && !isEmbedded"
              file-type="csv"
              :file-name="csvFileName"
              :data="csvData"
              class="csv-download"
            >
              <v-tooltip top class="download-csv">
                <template #activator="{ on, attrs }">
                  <v-btn
                    icon
                    class="ma-2 pt-1"
                    color="primary"
                    v-bind="attrs"
                    v-on="on"
                    ><v-icon>mdi-download</v-icon></v-btn
                  > </template
                ><span>Download this as a csv file</span></v-tooltip
              ></vue-blob-json-csv
            >
            <v-tooltip v-if="!embedded" top class="sync-toggle">
              <template #activator="{ on, attrs }">
                <v-btn
                  v-bind="attrs"
                  icon
                  class="ma-2"
                  color="primary"
                  v-on="on"
                  @click.native="toggleSync"
                >
                  <v-icon v-if="!syncedView">mdi-play</v-icon>
                  <v-icon v-else>mdi-pause</v-icon>
                </v-btn>
              </template>
              <span v-if="!syncedView">Sync views with workshop</span>
              <span v-else>Stop syncing views with workshop</span>
            </v-tooltip>
            <v-spacer />
          </v-card-actions>
        </v-card>
      </v-col>
    </v-row>

    <transition-group name="flip-list" tag="div" class="slidey-sort">
      <issue-block
        v-for="(issue, idx) in viewsPerIssue"
        :key="issue.id"
        v-hotkey="keymap"
        :data-issue="issue.id"
        v-bind="issue"
        class="issue-block"
        :class="{
          selected: issue.id === selectedIssue,
          current: issue.id === analystsIssue,
          first: idx === 0,
          last: idx === issues.length - 1,
          syncing: syncedView,
        }"
        :embedded="isEmbedded"
        :list-position="{ 0: 'First', [issues.length - 1]: 'Last' }[idx]"
        :index="idx"
        :element-labels="elementLabels"
        :is-selected="issue.id === selectedIssue"
        :loading-images="loadingImages"
        :issue="issue"
        @select="selectIssue"
        @edit="editIssueField"
        @delete="deleteIssue"
        @shift="shiftIssue(idx, $event)"
      />
    </transition-group>
    <v-row
      v-if="hasBindings"
      class="issue-row"
      @click.stop="selectIssue(undefined)"
    >
      <v-col
        style="width: 15px; height: 20px; max-width: 15px; cursor: pointer"
        align-self="center"
        class="pa-0 ma-0"
      >
        <v-sheet
          :color="!selectedIssue ? 'primary' : '#fafafa'"
          class="issue-selector"
          :class="{
            selected: !selectedIssue,
          }"
          width="15"
        />
      </v-col>
      <v-col class="text-caption">Next View in New Issue</v-col></v-row
    >
    <v-row class="footer-actions">
      <v-col align="end">
        <v-btn v-if="embedded" @click="toggleDeleted"
          >{{ showDeletedViews ? 'Exclude' : 'Include' }} Deleted Images</v-btn
        >
      </v-col>
    </v-row>

    <!-- <v-snackbar
      v-model="mapDrawer"
      class="mapBar"
      :class="{ collapsed: mapCollapse }"
      right
      color="white"
      bottom
      :timeout="mapTimeout"
      elevation="10"
      :rounded="mapCollapse ? 'l-lg' : 'tl-lg'"
      ><div id="mapZoomContainer">
        <v-sheet
          class="mapToggle"
          :rounded="mapCollapse ? 'l-lg' : 'tl-lg'"
          color="primary"
          width="2em"
          style="position: absolute; left: 0; bottom: 0; top: 0"
          @click="mapCollapse = !mapCollapse"
          ><span v-if="!mapCollapse">&gt;&gt;</span
          ><span v-else>&lt;&lt;</span></v-sheet
        >
        <svg-pan-zoom
          :min-zoom="0.75"
          :max-zoom="3"
          :dbl-click-zoom-enabled="false"
          :fit="true"
        >
          <svg
            v-if="!mapCollapse"
            id="map"
            :viewBox="`${mapViewBox[0]} ${mapViewBox[1]} ${mapViewBox[2]} ${mapViewBox[3]}`"
          >
            <g
              id="translate"
              fill="none"
              stroke="black"
              :transform="`translate(${mapTranslate[0] || 0},${
                mapTranslate[1] || 0
              }) scale(${mapZoomFactor}, -${mapZoomFactor})`"
            >
              <g id="boundingbox" v-html="bbox" />
              <g id="grid" v-html="grid" />
              <g id="footprint" v-html="footprint" />
              <g id="viewpoint" v-html="viewpointsplay" />
            </g>
          </svg>
        </svg-pan-zoom>
      </div>
    </v-snackbar> -->
  </v-container>
</template>

<style lang="scss">
  .map-splay,
  .map-vp {
    stroke-width: 2;
    stroke: var(--v-primary-base);
    fill: white;
  }
  .map-vp-index {
    font-size: 7px;
    font-weight: 900;
    stroke-width: 0;
    fill: var(--v-primary-base);
  }
  .mapToggle {
    display: flex;
    align-items: center;
    justify-items: center;
    cursor: pointer;

    span {
      flex-grow: 1;
      display: block;
      text-align: center;
      font-weight: 900;
    }
  }
  #map {
    margin: 10px;
    margin-left: 50%;
    margin-right: 50%;
    height: 300px;
    transform: translateY(2.5px) translateX(calc(15px - 50%));
  }

  #mapZoomContainer {
    padding: 0 2em;
  }

  #boundingbox path,
  #footprint path,
  #grid path {
    vector-effect: non-scaling-stroke;
  }

  #boundingbox {
    path {
      stroke-width: 0;
    }
  }

  #footprint {
    path {
      stroke-width: 2;
    }
  }

  #grid {
    path {
      stroke-width: 0.3;
    }
  }
  .mapBar {
    opacity: 0.9;

    .v-snack__wrapper {
      min-width: 2em;
      padding: 0;
    }
    .v-snack__content {
      width: 100%;
      margin-right: 0;
      padding: 0;
    }

    &.collapsed #mapZoomContainer {
      padding: 0;
    }
  }
</style>

<style lang="scss" scoped>
  .slidey-sort {
    transition: all 2s;
  }

  .download-button {
    padding: 0 8px;
  }
  .csv-download {
    cursor: pointer;
  }
</style>

<style lang="scss" scoped id="print-settings">
  @media print {
    .footer-actions,
    .header-actions,
    header .view,
    header .host,
    header .in,
    button,
    .v-input__append-inner,
    .description-fields .v-text-field__details {
      display: none !important;
    }

    header,
    footer {
      background-color: transparent !important;
      font-weight: bold;
      position: fixed;
      top: 0;
    }

    footer {
      top: auto;
      bottom: 0;
    }

    .v-main {
      padding-top: 0 !important;
    }

    .issue-view-row,
    .footer-actions,
    .header-actions,
    header,
    footer,
    button,
    .v-input__append-inner,
    .description-fields .v-text-field__details {
      display: none !important;
      &::v-deep .view,
      &::v-deep .host,
      &::v-deep .in {
        display: none !important;
      }
    }

    header ::v-deep .view {
      display: none;
    }
  }

  @page {
    margin: 0mm;
    margin-top: 8mm;
  }
</style>
